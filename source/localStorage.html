<title>Local Storage -js</title>
<body>
    <h2>Local Storage -js</h2>

    <button onclick="add()" type="button1">Add</button>
    <button onclick="update()" type="button1">Update</button>
    <button onclick="deleteLog()" type="button1">Delete</button>
    <button onclick="search()" type="button1">Search</button>
    <br><br>
    <button onclick="invokeAddLog()" type = "button1">Invoke Add Log</button>
    <button onclick="invokeAddLog2()" type = "button1">Invoke Add Log2</button>
    <button onclick="invokeAddLog3()" type = "button1">Invoke Add Log3</button>
    <button onclick="invokeAddLog4()" type = "button1">Invoke Add Log4</button>
    <button onclick="invokeAddLog5()" type = "button1">Invoke Add Log5</button>
    <button onclick="invokeAddLog6()" type = "button1">Invoke Add Log6</button>
    <button onclick="deleteAll()" type="button1">Delete All</button>
    <br>
    <br>
    Title: <input type="text" id="title"> </input><br><br>
    Notes: <input type="text" id="notes"> </input><br><br>
    Journal: <input type="text" id="journal"> </input>

    
    <script type="text/javascript">
        let EXIT_SUCESS = true;
        let EXIT_FAILURE = false;
        let myObject = [];
        //uuidv4();
        function add(){
            //let uuid = uuidv4();
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();

            today = mm + '/' + dd + '/' + yyyy;

            let title = document.getElementById('title').value;
            let notes = document.getElementById('notes').value;
            let journal = document.getElementById('journal').value;
            
            const myObject = {
                title: title,
                notes: notes,
                journal : journal,
            }
        
            localStorage.setItem(today, JSON.stringify(myObject));
        }
        function invokeAddLog(){        
            let date = "Friday, May 20, 2022";
            let notes = ["hi", "bye", "cry"];        
            let journal = "It was a dark and stormy night";
            addLog(date, notes, journal);
        }

        function invokeAddLog2(){        
            let date = "Friday, May 20, 2022";
            let notes2 = ["cry", "gimme", "ally"];        
            let journal2 = "At dusk they pour from the sky";
            addLog(date, notes2, journal2);
        }

        function invokeAddLog3(){        
            let date = "Fri, May 20, 2022";
            let notes2 = ["cry", "gimme", "ally"];        
            let journal2 = "At dusk they pour from the sky";
            addLog(date, notes2, journal2);
        }

        function invokeAddLog4(){        
            let date = "Friday, M 20, 2022";
            let notes2 = ["cry", "gimme", "ally"];        
            let journal2 = "At dusk they pour from the sky";
            addLog(date, notes2, journal2);
        }

        function invokeAddLog5(){        
            let date = "Friday, May 32, 2022";
            let notes2 = ["cry", "gimme", "ally"];        
            let journal2 = "At dusk they pour from the sky";
            addLog(date, notes2, journal2);
        }

        function invokeAddLog6(){        
            let date = "Friday, May 23, YEAR";
            let notes2 = ["cry", "gimme", "ally"];        
            let journal2 = "At dusk they pour from the sky";
            addLog(date, notes2, journal2);
        }

        function addLog(date, notes, journal){
            let dateSplitted = date.split(',');
            // Input validation for day of the week
            if (!(dateSplitted[0] == "Monday" || dateSplitted[0] == "Tuesday" || dateSplitted[0] == "Wednesday" || dateSplitted[0] == "Thursday" || dateSplitted[0] == "Friday" || dateSplitted[0] == "Saturday" || dateSplitted[0] == "Sunday")){
                console.log("Invalid Day of the Week passed: " + dateSplitted[0]);
                return EXIT_FAILURE;
            } 

            // Input validation for month/day
            // Note that February 31 or April 30 is considered valid in this checker
            let monthAndDay = dateSplitted[1].substring(1);
            monthAndDay = monthAndDay.split(' ');
            if(!(monthAndDay[0] == "January" || monthAndDay[0] == "February" || monthAndDay[0] == "March" || monthAndDay[0] == "April" || monthAndDay[0] == "May" || monthAndDay[0] == "June" || monthAndDay[0] == "July" || monthAndDay[0] == "August" || monthAndDay[0] == "September" || monthAndDay[0] == "October" || monthAndDay[0] == "November" || monthAndDay[0] == "December")){
                console.log("Invalid month passed: " + monthAndDay[0]);
                return EXIT_FAILURE;
            } else if (parseInt(monthAndDay[1]) < 1 || 31 < parseInt(monthAndDay[1])){
                console.log("Invalid day passed: " + monthAndDay[1]);
                return EXIT_FAILURE;
            }

            // Input validation for year
            // Note that it just checks whether the input is number
            let year = dateSplitted[2].substring(1);
            if (isNaN(parseInt(year))){
                console.log("Invalid year passed: " + year);
                return EXIT_FAILURE;
            }

            // Input validation for notes
            // Check whether it contains only strings
            for (let i = 0; i < notes.length; i++){
                if (typeof(notes[i]) != 'string'){
                    console.log("notes must contain only strings.")
                    return EXIT_FAILURE;
                }
            }

            // Input validation for journal
            // Check whether it is a string
            if (typeof(journal) != 'string'){
                console.log("journal must be string.")
                return EXIT_FAILURE;
            }

            if (localStorage.getItem(date) == null) {
                myObject = [];
            } else {                
                myObject = localStorage.getItem(date);
                console.log("There already exists a log having the same date");
                return EXIT_FAILURE;
            }

            myObject = {
                notes: notes,
                journal: journal
            }

            localStorage.setItem(date, JSON.stringify(myObject));
            console.log("Successfully added to the local storage");
            return EXIT_SUCESS;
        }

        function updateLog(date){
            let dateSplitted = date.split(',');
            console.log(dateSplitted);

            // Input validation for day of the week
            if (!(dateSplitted[0] == "Monday" || dateSplitted[0] == "Tuesday" || dateSplitted[0] == "Wednesday" || dateSplitted[0] == "Thursday" || dateSplitted[0] == "Friday" || dateSplitted[0] == "Saturday" || dateSplitted[0] == "Sunday")){
                console.log("Invalid Day of the Week passed: " + dateSplitted[0]);
                return EXIT_FAILURE;
            } 

            // Input validation for month/day
            // Note that February 31 or April 30 is considered valid in this checker
            let monthAndDay = dateSplitted[1].substring(1);
            monthAndDay = monthAndDay.split(' ');
            console.log(monthAndDay);
            if(!(monthAndDay[0] == "January" || monthAndDay[0] == "February" || monthAndDay[0] == "March" || monthAndDay[0] == "April" || monthAndDay[0] == "May" || monthAndDay[0] == "June" || monthAndDay[0] == "July" || monthAndDay[0] == "August" || monthAndDay[0] == "September" || monthAndDay[0] == "October" || monthAndDay[0] == "November" || monthAndDay[0] == "December")){
                console.log("Invalid month passed: " + monthAndDay[0]);
                return EXIT_FAILURE;
            } else if (parseInt(monthAndDay[1]) < 1 || 31 < parseInt(monthAndDay[1])){
                console.log("Invalid day passed: " + monthAndDay[1]);
                return EXIT_FAILURE;
            }

            // Input validation for year
            // Note that it just checks whether the input is number
            let year = dateSplitted[2].substring(1);
            if (isNaN(parseInt(year))){
                console.log("Invalid year passed: " + year);
                return EXIT_FAILURE;
            }

            let notes = document.getElementById('notes').value;
            let journal = document.getElementById('journal').value;

            // Input validation for notes
            // Check whether it contains only strings
            for (let i = 0; i < notes.length; i++){
                if (typeof(notes[i]) != 'string'){
                    console.log("notes must contain only strings.")
                    return EXIT_FAILURE;
                }
            }

            // Input validation for journal
            // Check whether it is a string
            if (typeof(journal) != 'string'){
                console.log("journal must be string.")
                return EXIT_FAILURE;
            }

            if (localStorage.getItem(date) == null){
                console.log("There is no log having the date: " + date);
                return EXIT_FAILURE;
            }

            myObject = {
                notes: notes,
                journal: journal
            }
            localStorage.setItem(date, JSON.stringify(myObject));
            console.log("Successfully updated to the local storage");
            return EXIT_SUCESS;
        }

        function fetchLog(date){
            let dateSplitted = date.split(',');
            console.log(dateSplitted);

            // Input validation for day of the week
            if (!(dateSplitted[0] == "Monday" || dateSplitted[0] == "Tuesday" || dateSplitted[0] == "Wednesday" || dateSplitted[0] == "Thursday" || dateSplitted[0] == "Friday" || dateSplitted[0] == "Saturday" || dateSplitted[0] == "Sunday")){
                console.log("Invalid Day of the Week passed: " + dateSplitted[0]);
                return EXIT_FAILURE;
            } 

            // Input validation for month/day
            // Note that February 31 or April 30 is considered valid in this checker
            let monthAndDay = dateSplitted[1].substring(1);
            monthAndDay = monthAndDay.split(' ');
            console.log(monthAndDay);
            if(!(monthAndDay[0] == "January" || monthAndDay[0] == "February" || monthAndDay[0] == "March" || monthAndDay[0] == "April" || monthAndDay[0] == "May" || monthAndDay[0] == "June" || monthAndDay[0] == "July" || monthAndDay[0] == "August" || monthAndDay[0] == "September" || monthAndDay[0] == "October" || monthAndDay[0] == "November" || monthAndDay[0] == "December")){
                console.log("Invalid month passed: " + monthAndDay[0]);
                return EXIT_FAILURE;
            } else if (parseInt(monthAndDay[1]) < 1 || 31 < parseInt(monthAndDay[1])){
                console.log("Invalid day passed: " + monthAndDay[1]);
                return EXIT_FAILURE;
            }

            // Input validation for year
            // Note that it just checks whether the input is number
            let year = dateSplitted[2].substring(1);
            if (isNaN(parseInt(year))){
                console.log("Invalid year passed: " + year);
                return EXIT_FAILURE;
            }

            let searchResult = localStorage.getItem(date);
            if (searchResult == null){
                console.log("No log found with the date: " + date);
                return EXIT_FAILURE;
            } else {
                console.log("Log successfully found.")
                return searchResult;
            }
        }

        function fetchAll(){
            let searchResult = [];
            for(let i = 0; i < localStorage.length; i++){
                console.log("Log at " + localStorage.key(i) + ": " + localStorage.getItem(localStorage.key(i)));
                searchResult.append(localStorage.getItem(localStorage.key(i)));
            }
            return searchResult;
        }

        function deleteAll(){
            localStorage.clear();
        }
    
        function update(){
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();

            today = mm + '/' + dd + '/' + yyyy;
            let title = document.getElementById('title').value;
            let notes = document.getElementById('notes').value;
            let journal = document.getElementById('journal').value;


            const myObject = {
                title: title,
                notes: notes,
                journal : journal,
            }
            localStorage.setItem(today, JSON.stringify(myObject));
        }
    
        function deleteLog(){
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();


            console.log("item removed: "+ today);
            localStorage.removeItem(today);
        }
    
        function search(){
            var i;
            for (i = 0; i < localStorage.length; i++)   {
                console.log(localStorage.key(i) + "=[" + localStorage.getItem(localStorage.key(i)) + "]");
            }
        }    

        //Generate an unique id
        function uuidv4() {
            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
        }


       
    </script>
    

</body>


